<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<template>
    
    <!-- 
    	Meta description of the templates, that anybody
    	knows what the template is doing
    -->
    <meta>
        <parameter name="name">Default template for Tactical Overview</parameter>
        <parameter name="description">Displays a Tactical Overview</parameter>
        <parameter name="author">icinga-web developers</parameter>
    </meta>

	<!--
		data sources 
	-->
	<datasources>
		<datasource id="LOCATIONS">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOSTGROUP</target>
			<columns>HOSTGROUP_ALIAS</columns>
		</datasource>

		<datasource id="HOST_STATUS_UP">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CURRENT_STATE</column>
					<value>0</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="HOST_STATUS_DOWN">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CURRENT_STATE</column>
					<value>1</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="HOST_STATUS_UNREACHABLE">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CURRENT_STATE</column>
					<value>2</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_HOST_STATUS_UP">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CURRENT_STATE</column>
					<value>0</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_HOST_STATUS_DOWN">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CURRENT_STATE</column>
					<value>1</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_HOST_STATUS_UNREACHABLE">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CURRENT_STATE</column>
					<value>2</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_STATUS_OK">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>SERVICE_CURRENT_STATE</column>
					<value>0</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_STATUS_WARNING">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>SERVICE_CURRENT_STATE</column>
					<value>1</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_STATUS_CRITICAL">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>SERVICE_CURRENT_STATE</column>
					<value>2</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_STATUS_UNKNOWN">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>SERVICE_CURRENT_STATE</column>
					<value>3</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="SERVICE_EXECUTION_TIME">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_EXECUTION_TIME_MIN,SERVICE_EXECUTION_TIME_MAX,SERVICE_EXECUTION_TIME_AVG</columns>
			<function>
				<name>round</name>
				<param>3</param>
			</function>
		</datasource>

		<datasource id="SERVICE_LATENCY">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_LATENCY_MIN,SERVICE_LATENCY_MAX,SERVICE_LATENCY_AVG</columns>
			<function>
				<name>round</name>
				<param>3</param>
			</function>
		</datasource>

		<datasource id="HOST_EXECUTION_TIME">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_EXECUTION_TIME_MIN,HOST_EXECUTION_TIME_MAX,HOST_EXECUTION_TIME_AVG</columns>
			<function>
				<name>round</name>
				<param>3</param>
			</function>
		</datasource>

		<datasource id="HOST_LATENCY">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_LATENCY_MIN,HOST_LATENCY_MAX,HOST_LATENCY_AVG</columns>
			<function>
				<name>round</name>
				<param>3</param>
			</function>
		</datasource>

		<datasource id="NUM_ACTIVE_HOST_CHECKS">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CHECK_TYPE</column>
					<value>0</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="NUM_ACTIVE_SERVICE_CHECKS">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>SERVICE_CHECK_TYPE</column>
					<value>0</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="NUM_PASSIVE_HOST_CHECKS">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST</target>
			<columns>HOST_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>HOST_CHECK_TYPE</column>
					<value>1</value>
				</columns>
			</filter>
		</datasource>

		<datasource id="NUM_PASSIVE_SERVICE_CHECKS">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE</target>
			<columns>SERVICE_OBJECT_ID</columns>
			<search_type>IcingaApi::SEARCH_TYPE_COUNT</search_type>
			<filter>
				<columns>
					<column>SERVICE_CHECK_TYPE</column>
					<value>1</value>
				</columns>
			</filter>
		</datasource>
	</datasources>

    <!--
    	html template
    -->
    <template_code>
    	<host_status>
    		<![CDATA[
    			<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td>
							<table border="0" cellpadding="0" cellspacing="0" style="filter:alpha(opacity=80);-moz-opacity:0.80;-khtml-opacity:0.80;opacity:0.80;">
								${if:${HOST_STATUS_UP:COUNT_HOST_OBJECT_ID} > 0}<tr><td style="background-color:#00cc00;">${HOST_STATUS_UP:COUNT_HOST_OBJECT_ID} UP</td></tr>${/if}
								${if:${HOST_STATUS_DOWN:COUNT_HOST_OBJECT_ID} > 0}<tr><td style="background-color:#cc0000;">${HOST_STATUS_DOWN:COUNT_HOST_OBJECT_ID} DOWN</td></tr>${/if}
								${if:${HOST_STATUS_UNREACHABLE:COUNT_HOST_OBJECT_ID} > 0}<tr><td style="background-color:#ff8000;">${HOST_STATUS_UNREACHABLE:COUNT_HOST_OBJECT_ID} UNREACHABLE</td></tr>${/if}
							</table>
						</td>
						<td>
							<table border="0" cellpadding="0" cellspacing="0" style="filter:alpha(opacity=80);-moz-opacity:0.80;-khtml-opacity:0.80;opacity:0.80;">
								${if:${SERVICE_STATUS_OK:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#00cc00;">${SERVICE_STATUS_OK:COUNT_SERVICE_OBJECT_ID} OK</td></tr>${/if}
								${if:${SERVICE_STATUS_WARNING:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#ffff00;">${SERVICE_STATUS_WARNING:COUNT_SERVICE_OBJECT_ID} WARNING</td></tr>${/if}
								${if:${SERVICE_STATUS_CRITICAL:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#ff0000;">${SERVICE_STATUS_CRITICAL:COUNT_SERVICE_OBJECT_ID} CRITICAL</td></tr>${/if}
								${if:${SERVICE_STATUS_UNKNOWN:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#ff8000;">${SERVICE_STATUS_UNKNOWN:COUNT_SERVICE_OBJECT_ID} UNKNOWN</td></tr>${/if}
							</table>
						</td>
					</tr>
				</table>
    		]]>
    	</host_status>

    	<service_status>
    		<![CDATA[
    			<table border="0" cellpadding="0" cellspacing="0">
    				<tr>
    					<td>
							<table border="0" cellpadding="0" cellspacing="0" style="filter:alpha(opacity=80);-moz-opacity:0.80;-khtml-opacity:0.80;opacity:0.80;">
								${if:${SERVICE_HOST_STATUS_UP:COUNT_HOST_OBJECT_ID} > 0}<tr><td style="background-color:#00cc00;">${SERVICE_HOST_STATUS_UP:COUNT_HOST_OBJECT_ID} UP</td></tr>${/if}
								${if:${SERVICE_HOST_STATUS_DOWN:COUNT_HOST_OBJECT_ID} > 0}<tr><td style="background-color:#cc0000;">${SERVICE_HOST_STATUS_DOWN:COUNT_HOST_OBJECT_ID} DOWN</td></tr>${/if}
								${if:${SERVICE_HOST_STATUS_UNREACHABLE:COUNT_HOST_OBJECT_ID} > 0}<tr><td style="background-color:#ff8000;">${SERVICE_HOST_STATUS_UNREACHABLE:COUNT_HOST_OBJECT_ID} UNREACHABLE</td></tr>${/if}
							</table>
						</td>
    					<td>
							<table border="0" cellpadding="0" cellspacing="0" style="filter:alpha(opacity=80);-moz-opacity:0.80;-khtml-opacity:0.80;opacity:0.80;">
								${if:${SERVICE_STATUS_OK:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#00cc00;">${SERVICE_STATUS_OK:COUNT_SERVICE_OBJECT_ID} OK</td></tr>${/if}
								${if:${SERVICE_STATUS_WARNING:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#ffff00;">${SERVICE_STATUS_WARNING:COUNT_SERVICE_OBJECT_ID} WARNING</td></tr>${/if}
								${if:${SERVICE_STATUS_CRITICAL:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#ff0000;">${SERVICE_STATUS_CRITICAL:COUNT_SERVICE_OBJECT_ID} CRITICAL</td></tr>${/if}
								${if:${SERVICE_STATUS_UNKNOWN:COUNT_SERVICE_OBJECT_ID} > 0}<tr><td style="background-color:#ff8000;">${SERVICE_STATUS_UNKNOWN:COUNT_SERVICE_OBJECT_ID} UNKNOWN</td></tr>${/if}
							</table>
						</td>
					</tr>
				</table>
    		]]>
    	</service_status>

    	<locations>
    		<![CDATA[
				<tr>
					<td>${LOCATIONS:HOSTGROUP_ALIAS}</td>
					<td>${host_status}</td>
				</tr>
			]]>
    	</locations>

		<performance>
			<![CDATA[
				<table border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td>Service Check Execution Time:</td>
						<td>${SERVICE_EXECUTION_TIME:SERVICE_EXECUTION_TIME_MIN} / ${SERVICE_EXECUTION_TIME:SERVICE_EXECUTION_TIME_MAX} / ${SERVICE_EXECUTION_TIME:SERVICE_EXECUTION_TIME_AVG} sec</td>
					</tr>
					<tr>
						<td>Service Check Latency:</td>
						<td>${SERVICE_LATENCY:SERVICE_LATENCY_MIN} / ${SERVICE_LATENCY:SERVICE_LATENCY_MAX} / ${SERVICE_LATENCY:SERVICE_LATENCY_AVG} sec</td>
					</tr>
					<tr>
						<td>Host Check Execution Time:</td>
						<td>${HOST_EXECUTION_TIME:HOST_EXECUTION_TIME_MIN} / ${HOST_EXECUTION_TIME:HOST_EXECUTION_TIME_MAX} / ${HOST_EXECUTION_TIME:HOST_EXECUTION_TIME_AVG} sec</td>
					</tr>
					<tr>
						<td>Host Check Latency:</td>
						<td>${HOST_LATENCY:HOST_LATENCY_MIN} / ${HOST_LATENCY:HOST_LATENCY_MAX} / ${HOST_LATENCY:HOST_LATENCY_AVG} sec</td>
					</tr>
					<tr>
						<td># Active Host / Service Checks:</td>
						<td>${NUM_ACTIVE_HOST_CHECKS:COUNT_HOST_OBJECT_ID} / ${NUM_ACTIVE_SERVICE_CHECKS:COUNT_SERVICE_OBJECT_ID}</td>
					</tr>
					<tr>
						<td># Passive Host / Service Checks:</td>
						<td>${NUM_PASSIVE_HOST_CHECKS:COUNT_HOST_OBJECT_ID} / ${NUM_PASSIVE_SERVICE_CHECKS:COUNT_SERVICE_OBJECT_ID}</td>
					</tr>
				</table>
			]]>
		</performance>

    	<MAIN>
	    	<![CDATA[
				<table width="100%" border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td><b>Locations</b></td>
						<td><b>Services</b></td>
						<td><b>Monitoring Performance</b></td>
					</tr>
					<tr>
						<td>
							<table border="0" cellpadding="0" cellspacing="0">
								${locations:HOSTGROUP_NAME,company1}
								${locations:HOSTGROUP_NAME,company2}
								${locations:HOSTGROUP_NAME,web_servers}
								${locations:HOSTGROUP_NAME,mail_servers}
							</table>
						</td>
						<td>
							<table border="0" cellpadding="0" cellspacing="0">
								<tr><td>Local</td><td>${service_status:SERVICEGROUP_NAME,local}</td></tr>
								<tr><td>Network</td><td>${service_status:SERVICEGROUP_NAME,network}</td></tr>
								<tr><td>Database</td><td>${service_status:SERVICEGROUP_NAME,database}</td></tr>
								<tr><td>Web</td><td>${service_status:SERVICEGROUP_NAME,web}</td></tr>
								<tr><td>Mail</td><td>${service_status:SERVICEGROUP_NAME,mail}</td></tr>
								</tr>
							</table>
						</td>
						<td>
							${performance}
						</td>					
					</tr>
				</table>
			]]>
		</MAIN>
    </template_code>
</template>