<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<template>
    
    <!-- 
    	Meta description of the templates, that anybody
    	knows what the template is doing
    -->
    <meta>
        <parameter name="name">Default icinga service status template</parameter>
        <parameter name="description">Displays object status information</parameter>
        <parameter name="author">icinga-web developers</parameter>
    </meta>
    
    <!-- 
    	Options for the template. Change layout and view style to fit the type you
    	want to display
    -->
    <option>
        <parameter name="mode">default</parameter>
        <parameter name="layout">IcingaTemplateAjaxGridLayout</parameter> 
        
        <!-- These are a dynamic js lib for using specific column renderes within this template -->
        <parameter name="dynamicscript">
        	<parameter>AppKit.Ext.grid.IcingaColumnRenderer</parameter>
        </parameter>
    </option>
    
    <!-- 
    	What data to display? Define icinga data targets and countfields
    -->
    <datasource>
        <parameter name="target">IcingaApi::TARGET_SERVICE</parameter>
        
        <parameter name="id">service_object_id</parameter>
        
        <!--
        	If the countmode is 'simple' countfields will be ignored always! To use with a pager
        	you have to use the 'field' mode to count all data independent from data
        -->
		<parameter name="countmode">field</parameter>
		
		<!-- 
			If the counting differs from data result you can specify a field to count
		-->
        <parameter name="countfields">
        	<parameter>SERVICE_ID</parameter>
        </parameter>
        
        <!-- 
        	Additional fields we would like to work with it (append them on the datasource
        	without working the default structures, e.g. for user classes)
        -->
       	<parameter name="additional_fields">
       		<parameter name="service_max_attempt">SERVICE_MAX_CHECK_ATTEMPTS</parameter>
       	</parameter>
         
    </datasource>
    
    <!-- 
    	Paging record on its result
    -->
    <pager>
    	<parameter name="enabled">true</parameter>
    	<parameter name="size">25</parameter>
    	<parameter name="start">0</parameter>
    </pager>
    
    <grouping>
    	<parameter name="enabled">true</parameter>
    	<parameter name="field">host_name</parameter>
    	
    	<parameter name="Ext.grid.GroupingView">
    		<parameter name="hideGroupedColumn">true</parameter>
    	</parameter>
    </grouping>
    
    <!--
    	Field decleration: What to display and how
    -->
    <fields>
    
		<field name="host_object_id">
            <datasource>
            	<parameter name="field">HOST_OBJECT_ID</parameter>
            </datasource>
            
            <display>
                <parameter name="visible">false</parameter>
                <parameter name="label">HostId</parameter>
            </display>
            
            <filter>
                <parameter name="enabled">false</parameter>
                
                <!-- Filter configuration -->
                <parameter name="type">extjs</parameter>
				<parameter name="subtype">appkit.ext.filter.number</parameter>
            </filter>
            
            <order>
                <parameter name="enabled">true</parameter>
                <parameter name="default">false</parameter>
                <parameter name="direction">ASC</parameter>
            </order>
        </field>
    
        <field name="service_object_id">
        	<datasource>
        		<parameter name="field">SERVICE_OBJECT_ID</parameter>
        	</datasource>
        	
        	<display>
                <parameter name="visible">false</parameter>
                <parameter name="label">Id</parameter>
            </display>
            
			<filter>
                <parameter name="enabled">true</parameter>
                
                <!-- Filter configuration -->
                <parameter name="type">extjs</parameter>
                <parameter name="subtype">appkit.ext.filter.number</parameter>
                
                <parameter name="no_operator">false</parameter>
               	                
				<parameter name="field">SERVICE_OBJECT_ID</parameter>
            </filter>
            
            <order>
                <parameter name="enabled">false</parameter>
                <parameter name="default">false</parameter>
            </order>
        </field>
    
        <field name="host_name">
            <datasource>
            	<parameter name="field">HOST_NAME</parameter>
            </datasource>
            
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label">Host</parameter>
                <!--
                <parameter name="userFunc">
                	<parameter name="class">IcingaTemplateDisplayTest</parameter>
                	<parameter name="method">Test</parameter>
					<parameter name="arguments">
						<parameter name="val">Test</parameter>
					</parameter>
                </parameter>
                -->
            </display>
            
            <filter>
                <parameter name="enabled">true</parameter>
                
                <!-- Filter configuration -->
                <parameter name="type">extjs</parameter>
				<parameter name="subtype">appkit.ext.filter.text</parameter>
            </filter>
            
            <order>
                <parameter name="enabled">true</parameter>
                <parameter name="default">true</parameter>
                <parameter name="direction">ASC</parameter>
                
                <!--  <parameter name="field">A_NEW_FIELD_TO_SORT</parameter> -->
            </order>
        </field>
        
        <field name="service_name">
            <datasource>
            	<parameter name="field">SERVICE_NAME</parameter>
            </datasource>
            
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label">Service</parameter>
            </display>
            
            <filter>
                <parameter name="enabled">true</parameter>
                
                <!-- Filter configuration -->
                <parameter name="type">extjs</parameter>
				<parameter name="subtype">appkit.ext.filter.text</parameter>
            </filter>
            
            <order>
                <parameter name="enabled">true</parameter>
                <!--  <parameter name="field">A_NEW_FIELD_TO_SORT</parameter> -->
            </order>
        </field>
        
        <field name="service_info">
            <datasource>
            	<parameter name="field">SERVICE_NAME</parameter>
            </datasource>

            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label"></parameter>

                <parameter name="width">22</parameter>

                <!-- Config for the AJAX grid (see http://www.extjs.com/deploy/dev/docs/?class=Ext.grid.Column) -->
                <parameter name="Ext.grid.Column">
                	<parameter name="menuDisabled">true</parameter>
                	<parameter name="fixed">true</parameter>
                </parameter>

                <parameter name="jsFunc">
                	<parameter>
	                	<parameter name="namespace">AppKit.Ext.grid.ColumnRenderer</parameter>
	                	<parameter name="function">columnImage</parameter>
	                	
	                	<!-- renderer/gridevent[cellclick|celldblclick|...] -->
	                	<parameter name="type">renderer</parameter>
	                	
	                	<parameter name="arguments">
							<parameter name="image">fam.information</parameter>
							<parameter name="css">x-icinga-grid-link</parameter>
							<parameter name="attr">
								<parameter name="qtip">Click here for information</parameter>
							</parameter>
	                	</parameter>
	                </parameter>

					<parameter>
	                	<parameter name="namespace">AppKit.Ext.grid.IcingaColumnRenderer</parameter>
	                	<parameter name="function">ajaxClick</parameter>

	                	<!-- renderer/gridevent[cellclick|celldblclick|...] -->
	                	<parameter name="type">celldblclick</parameter>

	                	<parameter name="arguments">
	                		<parameter name="src_id">serviceinfo</parameter>
	                		<parameter name="filter">
	                			<parameter name="host">host_name</parameter>
	                			<parameter name="service">service_name</parameter>
	                		</parameter>
	                	</parameter>
	                </parameter>
                </parameter>
            </display>

            <filter>
                <parameter name="enabled">false</parameter>
            </filter>

            <order>
                <parameter name="enabled">false</parameter>
            </order>
        </field>

        <field name="service_history_link">
            <datasource>
            	<parameter name="field">SERVICE_NAME</parameter>
            </datasource>
            
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label"></parameter>

                <parameter name="width">22</parameter>
                
                <!-- Config for the AJAX grid (see http://www.extjs.com/deploy/dev/docs/?class=Ext.grid.Column) -->
                <parameter name="Ext.grid.Column">
                	<parameter name="menuDisabled">true</parameter>
                	<parameter name="fixed">true</parameter>
                </parameter>

                <parameter name="jsFunc">
                
                	<parameter>
	                	<parameter name="namespace">AppKit.Ext.grid.ColumnRenderer</parameter>
	                	<parameter name="function">columnImage</parameter>
	                	
	                	<!-- renderer/gridevent[cellclick|celldblclick|...] -->
	                	<parameter name="type">renderer</parameter>
	                	
	                	<parameter name="arguments">
							<parameter name="image">fam.book</parameter>
							<parameter name="css">x-icinga-grid-link</parameter>
							<parameter name="attr">
								<parameter name="qtip">Click here for history</parameter>
							</parameter>
	                	</parameter>
	                </parameter>
	                
					<parameter>
	                	<parameter name="namespace">AppKit.Ext.grid.IcingaColumnRenderer</parameter>
	                	<parameter name="function">subGrid</parameter>
	                	
	                	<!-- renderer/gridevent[cellclick|celldblclick|...] -->
	                	<parameter name="type">celldblclick</parameter>
	                	
	                	<parameter name="arguments">
	                		<parameter name="idPrefix">historyForService</parameter>
	                		<parameter name="titlePrefix">Statehistory for</parameter>
							<parameter name="targetTemplate">icinga-service-history-template</parameter>
							<parameter name="sourceField">service_object_id</parameter>
							<parameter name="targetField">service_object_id</parameter>
							<parameter name="labelField">service_name</parameter>
	                	</parameter>
	                </parameter>
                
                </parameter>
                
            </display>
            
            <filter>
                <parameter name="enabled">false</parameter>
            </filter>
            
            <order>
                <parameter name="enabled">false</parameter>
            </order>
        </field>
        
        <field name="service_status">
        	<datasource>
        		<parameter name="field">SERVICE_CURRENT_STATE</parameter>
        	</datasource>
        	
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label">Status</parameter>
                
                <parameter name="width">100</parameter>
                
                <!-- Config for the AJAX grid (see http://www.extjs.com/deploy/dev/docs/?class=Ext.grid.Column) -->
                <parameter name="Ext.grid.Column">
                	<parameter name="fixed">true</parameter>
                </parameter>
                
				<parameter name="userFunc">
                	<parameter name="class">IcingaTemplateDisplayMonitoring</parameter>
                	<parameter name="method">serviceStatus</parameter>
					
                </parameter>
            </display>
        	
            <filter>
                <parameter name="enabled">false</parameter>    
            </filter>
            
            <order>
                <parameter name="enabled">true</parameter>
                <parameter name="default">false</parameter>
                <parameter name="field">SERVICE_CURRENT_STATE</parameter>
            </order>
        </field>

        <field name="service_last_check">
        	<datasource>
        		<parameter name="field">SERVICE_LAST_CHECK</parameter>
        	</datasource>
        	
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label">Last check</parameter>
                
                <!-- Let the agavi translation manager transform the date -->
                <parameter name="userFunc">
               		<parameter name="class">IcingaTemplateDisplayFormat</parameter>
               		<parameter name="method">agaviDateFormat</parameter>
                </parameter>
            </display>
        	
            <filter>
                <parameter name="enabled">false</parameter>    
            </filter>
            
            <order>
                <parameter name="enabled">true</parameter>
                <parameter name="default">true</parameter>
                <parameter name="order">DESC</parameter>
            </order>
        </field>

        <field name="service_check_attempt">
        	<datasource>
        		<parameter name="field">SERVICE_CURRENT_CHECK_ATTEMPT</parameter>
        	</datasource>
        	
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label">Attempt</parameter>
                
                <parameter name="width">100</parameter>
                
                <!-- Config for the AJAX grid (see http://www.extjs.com/deploy/dev/docs/?class=Ext.grid.Column) -->
                <parameter name="Ext.grid.Column">
                	<parameter name="fixed">true</parameter>
                </parameter>
                
				<parameter name="userFunc">
                	<parameter name="class">IcingaTemplateDisplayFormat</parameter>
                	<parameter name="method">formatTemplate</parameter>
					<parameter name="arguments">
						<parameter name="format"><![CDATA[${field.service_check_attempt} / ${field.service_max_attempt}]]></parameter>
					</parameter>
                </parameter>
            </display>
        	
            <filter>
                <parameter name="enabled">false</parameter>    
            </filter>
            
            <order>
                <parameter name="enabled">true</parameter>
                <parameter name="default">false</parameter>
            </order>
        </field>
        
        <field name="plugin_output">
        	<datasource>
        		<parameter name="field">SERVICE_OUTPUT</parameter>
        	</datasource>
        	
            <display>
                <parameter name="visible">true</parameter>
                <parameter name="label">Output</parameter>
                
                <parameter name="jsFunc">
                	<parameter name="namespace">AppKit.Ext.grid.ColumnRenderer</parameter>
                	<parameter name="function">truncateText</parameter>
                	<parameter name="arguments">
						<parameter name="length">40</parameter>
                	</parameter>
                </parameter>
            </display>
        	
            <filter>
                <parameter name="enabled">false</parameter>    
            </filter>
            
            <order>
                <parameter name="enabled">false</parameter>
                <parameter name="default">false</parameter>
            </order>
        </field>
        
        
    </fields>
    
</template>