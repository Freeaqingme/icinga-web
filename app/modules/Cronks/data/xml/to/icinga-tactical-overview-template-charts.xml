<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<template>
    
    <!-- 
    	Meta description of the templates, that anybody
    	knows what the template is doing
    -->
    <meta>
        <parameter name="name">Default template for Tactical Overview</parameter>
        <parameter name="description">Displays a Tactical Overview</parameter>
        <parameter name="author">icinga-web developers</parameter>
    </meta>

	<!--
		data sources 
	-->
	<datasources>
		<datasource id="HOST_STATUS_SUMMARY">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_HOST_STATUS_SUMMARY</target>
			<columns>HOST_CURRENT_STATE,HOST_STATE_COUNT</columns>
			<filter_mapping>
				<map name="CUSTOMVARIABLE_NAME">HOST_CUSTOMVARIABLE_NAME</map>
				<map name="CUSTOMVARIABLE_VALUE">HOST_CUSTOMVARIABLE_VALUE</map>
			</filter_mapping>
		</datasource>

		<datasource id="SERVICE_STATUS_SUMMARY">
			<source_type>IcingaApi</source_type>
			<target>IcingaApi::TARGET_SERVICE_STATUS_SUMMARY</target>
			<columns>SERVICE_CURRENT_STATE,SERVICE_STATE_COUNT</columns>
			<filter_mapping>
				<map name="CUSTOMVARIABLE_NAME">SERVICE_CUSTOMVARIABLE_NAME</map>
				<map name="CUSTOMVARIABLE_VALUE">SERVICE_CUSTOMVARIABLE_VALUE</map>
			</filter_mapping>
		</datasource>
	</datasources>
	
	

    <!--
    	html template
    -->
    <template_code>

		<sum_all>
			<![CDATA[
				<?php
					$hosts = $t->ds2Array('HOST_STATUS_SUMMARY');
					$services = $t->ds2Array('SERVICE_STATUS_SUMMARY');

					foreach ($hosts as $rid=>$r) {
						$hosts[$rid]['HOST_CURRENT_STATE'] = IcingaHostStateInfo::Create($r['HOST_CURRENT_STATE'])->getCurrentStateAsText();
					}

					foreach ($services as $rid=>$r) {
						$services[$rid]['SERVICE_CURRENT_STATE'] = IcingaServiceStateInfo::Create($r['SERVICE_CURRENT_STATE'])->getCurrentStateAsText();
					}

				?>

				<table border="0">
				<tr>

					<td>
						<strong>Hosts</strong>
						<?php echo $t->jsChart($hosts, 'piechart', array (
							'dataField' => 'HOST_STATE_COUNT',
							'categoryField' => 'HOST_CURRENT_STATE',
							'width' =>  400,
							'height' =>  400
						)); ?>

					</td>

					<td>
						<strong>Services</strong>
						<?php echo $t->jsChart($services, 'piechart', array (
							'dataField' => 'SERVICE_STATE_COUNT',
							'categoryField' => 'SERVICE_CURRENT_STATE',
							'width' =>  400,
							'height' =>  400
						)); ?>

					</td>
				</tr>
				</table>
			]]>
		</sum_all>

    	<MAIN>
	    	<![CDATA[
				<?php echo $t->renderTemplate('sum_all'); ?>
			]]>
		</MAIN>
    </template_code>
</template>