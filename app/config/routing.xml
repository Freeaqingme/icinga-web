<?xml version="1.0" encoding="UTF-8"?>
<configurations xmlns="http://agavi.org/agavi/1.0/config">
	<configuration>
		<routes>
		
			<!-- INDEX -->
			<route name="index_page" pattern="^/$" module="Web" action="Icinga.PortalView" />
		
			<!-- ICINGAAppKit routes -->
			<route name="appkit" pattern="^/appkit" module="%actions.default_module%">
				
				<route name=".login" pattern="^/login" action="AjaxLogin">
					<route name=".provider" pattern="^/json" output_type="json" />
				</route>
				
				<route name=".logout" pattern="^/logout" action="Logout"/>
				
				<route name=".squishloader" pattern="^/squishloader/(type:([\w\.\-\_\s]+))" action="Widgets.SquishLoader" output_type="simple" />
				
				<route name="appkit.admin" pattern="^/admin" action="Admin.Index">
				
					<route name=".principaledit" pattern="^/principaleditor/(principal:(\d+))" action="Admin.PrincipalEditor" output_type="simple" />
				
					<route name=".users" pattern="^/users" action="Admin.Users.Index">
						<route pattern="^/(id:(\d+|new))">
							<route name=".edit" pattern="^$" action="Admin.Users.Edit" />
						</route>
					</route>
					
					<route name="appkit.admin.groups" pattern="^/groups" action="Admin.Groups.Index">
						<route pattern="^/(id:(\d+|new))">
							<route name=".edit" pattern="^$" action="Admin.Groups.Edit" />
						</route>
					</route>
					
					<route name=".logs" pattern="^/logs" action="Admin.ViewLogs" />
					
				</route>
				
				
				<!-- 
					ExtJS specific content.
					* The app state from the database as json
					* Loading occasional used javascript on the fly
				-->
				<route pattern="^/ext" name=".ext">
					<route pattern="^/applicationState$" name=".applicationState" output_type="javascript" action="Ext.ApplicationState" />
					<route pattern="^/dynascript/(script:([\w-_\.]+))$" name=".dynamicScriptSource" output_type="javascript" action="Ext.DynamicJavascriptSource" />
				</route>
				
			</route>
			
			<!-- My routes (AppKit preferences) -->
			<route name="my" pattern="^/my" module="AppKit">
				<route pattern="^$" action="User.Index" />
				
				<route name=".preferences" pattern="^/preferences">
					<route pattern="^$" action="User.Preferences" /> 
				</route>
			</route>
			
			<!-- ICINGA routes -->
			<route name="icinga" pattern="^/web" module="Web">
			
				<!-- Icinga index route -->
				<route name=".home" pattern="^$" action="Index" />
				<route name=".about" pattern="^/about$" action="Icinga.Help" output_type="simple" />
				
				<!-- The main view -->
				<route name=".portalView" pattern="^/portal$" action="Icinga.PortalView" />
				
				<!--
					Cronks:
						* loader
						* json data sources
						* special content
				-->
				<route pattern="^/cronks" name=".cronks" output_type="simple" module="Cronks">
					
					<!-- The cronkloader -->
					<route name=".crloader" pattern="^/cloader/(cronk:([\w\.\-\_\s]+))" action="System.CronkLoader" />

					<!-- Simpleprovider for popups -->
					<route name=".simpleDataProvider.json" pattern="^/simpleDataProvider/json" output_type="json" action="IcingaApiSimpleDataProvider" />

					<!-- Datasources for the cronks -->
					<route name=".crlisting.json" pattern="^/clisting/json" output_type="json" action="System.CronkListing" />
					<route name=".objectsearch.json" pattern="^/objectSearch/json" output_type="json" action="System.ObjectSearch" />
					<route name=".statusSummary.json" pattern="^/statusSummary/json" output_type="json" action="System.StatusSummary" />

					<route name=".statusMap.json" pattern="^/statusMap/json" output_type="json" action="System.StatusMap" />
					<route name=".statusMap" pattern="^/statusMap" action="System.StatusMap" />

					<route name=".staticContent.ajax" pattern="^/staticContent/(template:([\w\.\-\_\s]+))/ajax" output_type="simple" action="System.StaticContent" />

					<route name=".viewProc" pattern="^/viewproc/(template:([\w\.\-\_\s]+))">
						<route name=".json" pattern="^/json" output_type="json" action="System.ViewProc">
							<route name=".metaInfo" pattern="^/inf" action="System.ViewProc.MetaInformation" />
						</route>
					</route>
					
					<!-- Commanddispatcher json interface -->
					<route name=".commandProc" pattern="^/commandproc/(command:([\w_]+))/json" output_type="json">
						<route name=".metaInfo" pattern="^/inf" action="System.ViewProc.CommandMetaInformation" />
						<route name=".send" pattern="^/send" action="System.ViewProc.SendCommand" />
					</route>

				</route>

			</route>
			
		</routes>
	</configuration>
</configurations>
